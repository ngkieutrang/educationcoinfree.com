<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>desired wishes</title>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    :root {
      --primary: #ff0050;
      --bg: #fafafa;
      --card-bg: #fff;
      --text: #111;
      --subtext: #555;
      --tick-blue: #1e88e5;
      --brand-red: #ff0050;
      --brand-cyan: #00f2ea;
    }
    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--bg);
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
    }
    .container {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 6px 16px rgba(0,0,0,0.08);
      max-width: 960px;
      width: 100%;
    }
    h2 { text-align:center; margin:0; color:var(--text); }
    .note { text-align:center; margin:10px 0 20px; color:var(--primary); font-size:14px; }
    .user-box {
      display:flex; align-items:center; border:1px solid #ddd;
      border-radius:12px; padding:10px 14px; margin-bottom:10px; background:#fff;
      position:relative; /* ƒë·ªÉ ƒë·∫∑t statusIcon ch√≠nh x√°c */
    }
    .user-box img { width:28px; height:28px; margin-right:10px; }
    .user-box input { flex:1; border:none; outline:none; font-size:16px; padding-right:36px; }

    /* status icon ƒë·∫∑t ngay sau t√™n (left t√≠nh b·∫±ng JS) */
    #statusIcon {
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      left:0;
      pointer-events:none;
      width:20px;
      height:20px;
      opacity:0;
      transition: opacity .15s ease, transform .15s ease;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    #statusIcon.visible { opacity:1; }

    /* brand loader: hai v√≤ng (red + cyan) */
    .brand-loader {
      position: relative;
      width:20px;
      height:20px;
    }
    .brand-loader::before,
    .brand-loader::after {
      content: "";
      position: absolute;
      inset: 0;
      border-radius: 50%;
      border: 2.5px solid transparent;
      box-sizing: border-box;
      animation: brand-spin 1s linear infinite;
    }
    .brand-loader::before { border-top-color: var(--brand-red); }
    .brand-loader::after { border-bottom-color: var(--brand-cyan); animation-delay: -0.5s; }
    @keyframes brand-spin { 0%{transform:rotate(0)}100%{transform:rotate(360deg)} }

    /* tick and cross */
    .status-success {
      display:inline-flex; align-items:center; justify-content:center;
      width:20px; height:20px; font-size:13px; color:var(--tick-blue);
      background: rgba(30,136,229,0.08); border-radius:50%; border:1px solid rgba(30,136,229,0.15);
    }
    .status-error {
      display:inline-flex; align-items:center; justify-content:center;
      width:20px; height:20px; font-size:13px; color:var(--brand-red);
      background: rgba(255,0,80,0.06); border-radius:50%; border:1px solid rgba(255,0,80,0.12);
    }

    /* Center loader overlay (shown when clicking Next) */
    #centerLoader {
      position: fixed;
      inset: 0;
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      background: rgba(0,0,0,0.12);
    }
    #centerLoader.visible { display:flex; }

    /* user profile block (kept for display but not tied to any external API) */
    #userProfile {
      display:none;
      align-items:center;
      gap:12px;
      margin:-5px 0 20px 0;
      padding:8px 12px;
      background:#f9f9f9;
      border-radius:12px;
      border:1px solid #ddd;
    }
    #userProfile img {
      width:48px;
      height:48px;
      border-radius:50%;
      border:1px solid #ccc;
      object-fit:cover;
    }
    #userDisplayName {
      font-weight:bold;
      font-size:15px;
    }
    #userUsername {
      color:#888;
      font-size:13px;
    }

    .coins-grid {
      display:grid; grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
      gap:16px;
    }
    .coin-card {
      background:#fff;
      border:2px solid #ddd;
      border-radius:14px;
      padding:18px 12px;
      text-align:center;
      font-size:18px;
      font-weight:bold;
      cursor:pointer;
      transition:.25s;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
    }
    .coin-card img { width:28px; height:28px; }
    .coin-card:hover { border-color:var(--primary); transform:translateY(-3px); }
    .coin-card.active {
      border-color:var(--primary);
      background:#fff0f5;
      box-shadow:0 0 10px rgba(255,0,80,.2);
    }
    .price { font-size:14px; font-weight:normal; color:var(--subtext); }
    .range { font-size:13px; color:#666; }
    .custom-input input {
      border:none; border-bottom:2px solid #333;
      outline:none; text-align:center; font-size:16px;
      background:transparent; width:100%;
    }
    .bottom {
      margin-top:25px; display:flex; justify-content:space-between;
      align-items:center; flex-wrap:wrap; gap:12px;
    }
    .total { font-size:16px; font-weight:bold; }
    button {
      padding:14px 28px; background:var(--primary); color:#fff;
      font-weight:600; border:none; border-radius:12px;
      cursor:pointer; font-size:16px; transition:.25s;
    }
    button:hover { background:#e60048; }
    @media (max-width:600px){
      .bottom { flex-direction:column; align-items:stretch; }
      button { width:100%; }
      .total { text-align:center; }
    }
    h3 { margin-top:30px; margin-bottom:15px; text-align:center; color:var(--text); }

    .payment-methods {
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:20px;
      margin-bottom:20px;
    }
    .pay-option {
      border:2px solid #ddd;
      border-radius:16px;
      padding:10px 14px;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      cursor:pointer;
      font-size:13px;
      background:#fff;
      transition:.25s;
      box-shadow:0 2px 4px rgba(0,0,0,0.05);
    }
    .pay-option img {
      width:45px;
      height:auto;
      object-fit:contain;
      filter: drop-shadow(0 1px 1px rgba(0,0,0,0.1));
      transition: transform .2s ease;
    }
    .pay-option span {
      font-weight:600;
      font-size:13px;
      color:#333;
    }
    .pay-option:hover img { transform: scale(1.1); }
    .pay-option:hover { border-color:var(--primary); }
    .pay-option.active {
      border-color:var(--primary);
      background:#fff0f5;
      box-shadow:0 0 6px rgba(255,0,80,.2);
    }
  </style>
</head>
<body>
<div class="container">
  <h2>desired wishes</h2>
  <div class="note">Save about 25% on service fees from third-party providers.</div>

  <div class="user-box">
    <img src="https://i.imgur.com/ViazpQP.png" alt="user">
    <input type="text" id="username" placeholder="Enter your username" autocomplete="off">
    <div id="statusIcon" aria-hidden="true"></div>
  </div>

  <!-- Hi·ªÉn th·ªã th√¥ng tin ng∆∞·ªùi d√πng (gi·ªØ nguy√™n nh∆∞ng hi·ªán gi·ªù kh√¥ng d√πng API) -->
  <div id="userProfile">
    <img id="userAvatar" src="" alt="avatar">
    <div>
      <div id="userDisplayName"></div>
      <div id="userUsername"></div>
    </div>
  </div>

  <div class="coins-grid">
    <div class="coin-card" onclick="selectCoin(this,30,0.38)"> 
      <img src="https://i.imgur.com/12j33cb.png"> 30 
      <div class="price">$0.38</div>
    </div>
    <div class="coin-card" onclick="selectCoin(this,350,4.36)"> 
      <img src="https://i.imgur.com/12j33cb.png"> 350 
      <div class="price">$4.36</div>
    </div>
    <div class="coin-card" onclick="selectCoin(this,700,8.73)"> 
      <img src="https://i.imgur.com/12j33cb.png"> 700 
      <div class="price">$8.73</div>
    </div>
    <div class="coin-card" onclick="selectCoin(this,1400,17.45)"> 
      <img src="https://i.imgur.com/12j33cb.png"> 1,400 
      <div class="price">$17.45</div>
    </div>
    <div class="coin-card" onclick="selectCoin(this,3500,43.63)"> 
      <img src="https://i.imgur.com/12j33cb.png"> 3,500 
      <div class="price">$43.63</div>
    </div>
    <div class="coin-card" onclick="selectCoin(this,7000,87.27)"> 
      <img src="https://i.imgur.com/12j33cb.png"> 7,000 
      <div class="price">$87.27</div>
    </div>
    <div class="coin-card" onclick="selectCoin(this,17500,218.17)"> 
      <img src="https://i.imgur.com/12j33cb.png"> 17,500 
      <div class="price">$218.17</div>
    </div>

    <div class="coin-card custom-card" onclick="showCustomInput(this)">
      <img src="https://i.imgur.com/12j33cb.png">
      <div class="custom-default">
        <strong>Custom</strong>
        <div class="price">Support large quantities</div>
      </div>
      <div class="custom-input" style="display:none;">
        <input type="number" id="customCoins" placeholder="Enter number of coins" min="30" max="2500000" oninput="updateCustom(this.value)">
        <div class="price" id="customPrice">$0</div>
        <div class="range">30 ‚Äì 2,500,000</div>
      </div>
    </div>
  </div>

  <h3>Select Payment Method</h3>
  <div class="payment-methods">
    <div class="pay-option" onclick="selectPayment(this,'VISA')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/Visa_Logo.png" alt="Visa">
      <span>VISA</span>
    </div>
    <div class="pay-option" onclick="selectPayment(this,'MasterCard')">
      <img src="https://upload.wikimedia.org/wikipedia/commons/0/04/Mastercard-logo.png" alt="MasterCard">
      <span>MasterCard</span>
    </div>
  </div>

  <div class="bottom">
    <div class="total">Total: <span id="total">0</span> coins</div>
    <button onclick="confirm()">Next</button>
  </div>
</div>

<!-- Center loader shown on Next -->
<div id="centerLoader" role="status" aria-hidden="true">
  <div class="brand-loader" aria-hidden="true"></div>
</div>

<script>
  // --- gi·ªØ nguy√™n logic ch·ªçn g√≥i / payment / confirm (s·ª≠a confirm ƒë·ªÉ show center loader) ---
  let selected = null;
  let selectedPrice = 0;
  let isCustom = false;
  let selectedPayment = null;

  function selectCoin(el, amount, price) {
    document.querySelectorAll(".coin-card").forEach(c => c.classList.remove("active"));
    el.classList.add("active");
    selected = amount;
    selectedPrice = price;
    isCustom = false;
    document.getElementById("total").innerText = amount;
  }

  function showCustomInput(el) {
    document.querySelectorAll(".coin-card").forEach(c => c.classList.remove("active"));
    el.classList.add("active");
    el.querySelector(".custom-default").style.display = "none";
    el.querySelector(".custom-input").style.display = "block";
    el.querySelector("#customCoins").focus();
  }

  function updateCustom(value) {
    const coins = parseInt(value) || 0;
    if (coins < 30 || coins > 2500000) {
      selected = null;
      isCustom = false;
      document.getElementById("customPrice").innerText = "$0";
      document.getElementById("total").innerText = 0;
      return;
    }
    selected = coins;
    isCustom = true;
    const usd = (coins * 326 / 26100).toFixed(2);
    document.getElementById("customPrice").innerText = "$" + usd;
    document.getElementById("total").innerText = coins;
  }

  function selectPayment(el, method) {
    document.querySelectorAll(".pay-option").forEach(c => c.classList.remove("active"));
    el.classList.add("active");
    selectedPayment = method;
  }

  // center loader element
  const centerLoader = document.getElementById('centerLoader');

  function showCenterLoader() {
    centerLoader.classList.add('visible');
  }
  function hideCenterLoader() {
    centerLoader.classList.remove('visible');
  }

  function confirm() {
    const username = document.getElementById("username").value.trim();
    if (!username) {
      Swal.fire({ icon:'warning', title:'Warning', text:'Please enter your username!' });
      return;
    }
    if (!selected) {
      Swal.fire({ icon:'warning', title:'Warning', text:'Please select a coin package!' });
      return;
    }
    if (!selectedPayment) {
      Swal.fire({ icon:'warning', title:'Warning', text:'Please select a payment method!' });
      return;
    }

    const price = isCustom ? (selected * 326 / 26100).toFixed(2) : selectedPrice;

    // show center loader for 1s then show final Swal
    showCenterLoader();
    setTimeout(() => {
      hideCenterLoader();
      Swal.fire({
        icon: 'success',
        title: 'üéâ successful entry!',
        html: `
          <p>You have successfully purchased <b>${selected}</b> coins for <b>@${username}</b>.</p>
          <p>üí≥ Amount: <b>$${price}</b></p>
          <p>üè¶ Payment Method: <b>${selectedPayment}</b></p>
          <p style="margin-top:8px; color:#666; font-size:14px;">
            ‚è≥ Please wait 5‚Äì15 minutes for the system to process your transaction.
          </p>
        `,
        confirmButtonText: 'OK',
        confirmButtonColor: '#16a34a'
      }).then(() => {
        // reset UI after dialog closed
        document.getElementById("username").value = "";
        hideStatusIcon();
        const customCoinsElem = document.getElementById("customCoins");
        if (customCoinsElem) customCoinsElem.value = "";
        document.getElementById("customPrice").innerText = "$0";
        document.getElementById("total").innerText = 0;
        selected = null;
        selectedPayment = null;
        document.querySelectorAll(".pay-option").forEach(c => c.classList.remove("active"));
        document.querySelectorAll(".coin-card").forEach(c => {
          if (c.querySelector(".custom-default")) {
            c.querySelector(".custom-default").style.display = "block";
            c.querySelector(".custom-input").style.display = "none";
          }
        });
      });
    }, 1000);
  }

  // --- LOADING / STATUS ICON LOGIC (3 gi√¢y) ---
  const inputUsername = document.getElementById('username');
  const statusIcon = document.getElementById('statusIcon');

  let typingTimer = null;
  const WAIT_MS = 3000; // 3 gi√¢y

  // canvas ƒë·ªÉ ƒëo chi·ªÅu r·ªông chu·ªói v·ªõi c√πng font c·ªßa input
  const measureCanvas = document.createElement('canvas');
  const measureCtx = measureCanvas.getContext('2d');

  function measureTextWidth(text) {
    const cs = window.getComputedStyle(inputUsername);
    const fontSize = cs.fontSize || '16px';
    const fontFamily = cs.fontFamily || 'Segoe UI';
    const fontWeight = cs.fontWeight || '400';
    // set a simple font string
    measureCtx.font = `${fontWeight} ${fontSize} ${fontFamily}`;
    return measureCtx.measureText(text).width;
  }

  function updateStatusPosition() {
    const val = inputUsername.value || '';
    if (!val.trim()) {
      // ·∫©n icon n·∫øu r·ªóng
      statusIcon.classList.remove('visible');
      statusIcon.innerHTML = '';
      return;
    }

    const userBox = inputUsername.closest('.user-box');
    const inputStyle = window.getComputedStyle(inputUsername);
    const inputPaddingLeft = parseFloat(inputStyle.paddingLeft || 0);

    // ƒëo chi·ªÅu r·ªông c·ªßa chu·ªói (th√™m 1 k√Ω t·ª± kho·∫£ng c√°ch)
    const textWidth = measureTextWidth(val + ' ');
    // offsetLeft t√≠nh theo user-box
    const left = inputUsername.offsetLeft + inputPaddingLeft + textWidth;

    // gi·ªõi h·∫°n kh√¥ng ƒë·ªÉ icon qu√° sang ph·∫£i (n·∫±m trong userBox)
    const maxLeft = userBox.clientWidth - 28; // margin
    const finalLeft = Math.min(left, maxLeft);

    statusIcon.style.left = finalLeft + 'px';
    statusIcon.classList.add('visible');
  }

  function showSpinner() {
    updateStatusPosition();
    statusIcon.innerHTML = `<div class="brand-loader" aria-hidden="true"></div>`;
    statusIcon.classList.add('visible');
  }

  function showTick() {
    updateStatusPosition();
    statusIcon.innerHTML = `<div class="status-success" aria-hidden="true">‚úî</div>`;
    statusIcon.classList.add('visible');
  }

  function showCross() {
    updateStatusPosition();
    statusIcon.innerHTML = `<div class="status-error" aria-hidden="true">‚úñ</div>`;
    statusIcon.classList.add('visible');
  }

  function hideStatusIcon() {
    statusIcon.classList.remove('visible');
    statusIcon.innerHTML = '';
  }

  function hasVietnameseAccent(str) {
    return /[√†√°·∫°·∫£√£√¢·∫ß·∫•·∫≠·∫©·∫´ƒÉ·∫±·∫Ø·∫∑·∫≥·∫µ√®√©·∫π·∫ª·∫Ω√™·ªÅ·∫ø·ªá·ªÉ·ªÖ√¨√≠·ªã·ªâƒ©√≤√≥·ªç·ªè√µ√¥·ªì·ªë·ªô·ªï·ªó∆°·ªù·ªõ·ª£·ªü·ª°√π√∫·ª•·ªß≈©∆∞·ª´·ª©·ª±·ª≠·ªØ·ª≥√Ω·ªµ·ª∑·ªπƒë]/i.test(str);
  }

  // Khi ng∆∞·ªùi d√πng g√µ -> hi·ªán loader ngay, reset timer, sau WAIT_MS show tick or cross
  inputUsername.addEventListener('input', () => {
    clearTimeout(typingTimer);

    if (!inputUsername.value.trim()) {
      hideStatusIcon();
      return;
    }

    // show loader ngay
    showSpinner();

    typingTimer = setTimeout(() => {
      const val = inputUsername.value.trim();

      // sau WAIT_MS: ki·ªÉm tra ƒëi·ªÅu ki·ªán; n·∫øu <4 k√Ω t·ª± ho·∫∑c c√≥ d·∫•u -> ‚ùå ; else ‚Üí ‚úî
      if (val.length < 4 || hasVietnameseAccent(val)) {
        showCross();
      } else {
        showTick();
      }
    }, WAIT_MS);
  });

  // Update v·ªã tr√≠ khi resize window (gi·ªØ tick ƒë√∫ng ch·ªó)
  window.addEventListener('resize', () => {
    if (statusIcon.innerHTML) updateStatusPosition();
  });

  // Update position on focus/paste/keyup
  inputUsername.addEventListener('focus', () => { if (statusIcon.innerHTML) updateStatusPosition(); });
  inputUsername.addEventListener('blur', () => {});
  inputUsername.addEventListener('keyup', () => { if (statusIcon.innerHTML) updateStatusPosition(); });
  inputUsername.addEventListener('paste', () => { setTimeout(() => { if (statusIcon.innerHTML) updateStatusPosition(); }, 10); });

  // End of script
</script>
</body>
</html>
